import { createContext, useContext, useEffect, useMemo, useState } from 'react';

export const LANGUAGE_OPTIONS = [
  { code: 'fr', label: 'Français' },
  { code: 'en', label: 'English' },
  { code: 'es', label: 'Español' },
  { code: 'ar', label: 'العربية' },
];

const TRANSLATIONS = {
  fr: {
    'nav.home': 'Accueil',
    'nav.map': 'Carte',
    'nav.categories': 'Catégories',
    'nav.history': 'Historique',
    'nav.profile': 'Profil',
    'nav.admin': 'Admin',
    'nav.search': 'Recherche',
    'nav.notifications': 'Notifications',
    'nav.markAllRead': 'Tout lire',
    'nav.loading': 'Chargement...',
    'nav.noNotifications': 'Aucune notification.',
    'nav.myProfile': 'Mon Profil',
    'nav.logout': 'Déconnexion',
    'nav.modeLight': 'Mode clair',
    'nav.modeDark': 'Mode sombre',
    'nav.switchToLight': 'Passer en mode clair',
    'nav.switchToDark': 'Passer en mode sombre',

    'common.loading': 'Chargement...',
    'common.notFound': 'Introuvable',
    'common.search': 'Rechercher',
    'common.filter': 'Filtre',
    'common.advancedFilters': 'Filtres avancés',
    'common.apply': 'Appliquer',
    'common.reset': 'Réinitialiser',
    'common.cancel': 'Annuler',
    'common.save': 'Enregistrer',
    'common.previous': 'Précédent',
    'common.next': 'Suivant',
    'common.page': 'Page',
    'common.all': 'Tous',
    'common.allF': 'Toutes',
    'common.status': 'Statut',
    'common.type': 'Type',
    'common.brand': 'Marque',
    'common.floor': 'Étage',
    'common.room': 'Salle',
    'common.distance': 'Distance',
    'common.description': 'Description',
    'common.features': 'Fonctionnalités',
    'common.actions': 'Actions',
    'common.target': 'Cible',
    'common.language': 'Langue',
    'common.chooseLanguage': 'Choisir la langue',

    'home.heroTitle': 'Que cherchez-vous dans le bâtiment ?',
    'home.heroSub': "Recherchez un équipement, vérifiez sa disponibilité et accédez rapidement à sa fiche.",
    'home.searchPlaceholder': 'Ex: Imprimante, Projecteur 4K, Scanner...',
    'home.quickAccess': 'Accès rapide',
    'home.seeAll': 'Voir tout',
    'home.noCategories': 'Aucune catégorie disponible.',
    'home.distanceSort': 'Trier par distance (proche → loin)',
    'home.footerProject': "SMARTFIND — Projet de fin d'étude",

    'search.placeholder': 'Rechercher (ex: Scanner, Imprimante...)',
    'search.fonction': 'Fonctionnalité',
    'search.floorLabel': 'Étage',
    'search.roomLabel': 'Salle',
    'search.distanceSort': 'Trier par distance (proche → loin)',
    'search.distanceMax': 'Distance max (optionnel)',
    'search.distanceExample': 'ex: 30',
    'search.searching': 'Recherche en cours...',
    'search.results': 'résultats',
    'search.distanceFromUser': 'de votre position',
    'search.viewDetails': 'Voir détails',
    'search.unknownRoom': 'Salle inconnue',
    'search.floorPrefix': 'Étage',
    'search.unknownDistance': 'Distance inconnue',

    'categories.title': 'Catalogue des équipements',
    'categories.subtitle': "Accédez à l’inventaire par catégorie.",
    'categories.noData': 'Aucune catégorie disponible.',
    'categories.devices': 'appareils',

    'history.title': 'Journal d’activités',
    'history.subtitle': 'Suivi des actions et historique de recherche.',
    'history.recentActions': 'Actions récentes',
    'history.searchHistory': 'Historique de recherche',
    'history.noRecentActions': 'Aucune action récente.',
    'history.noSearchHistory': 'Aucune recherche enregistrée.',
    'history.equipmentReservation': "Réservation d’équipement",
    'history.unknownDate': 'Date inconnue',

    'profile.userNotFound': 'Utilisateur introuvable.',
    'profile.preferences': 'Préférences',
    'profile.changePassword': 'Changer le mot de passe',
    'profile.currentPassword': 'Mot de passe actuel',
    'profile.newPassword': 'Nouveau mot de passe',
    'profile.confirmPassword': 'Confirmer le nouveau mot de passe',
    'profile.fillAllFields': 'Veuillez remplir tous les champs.',
    'profile.passwordMin': 'Le nouveau mot de passe doit contenir au moins 6 caractères.',
    'profile.passwordMismatch': 'Les mots de passe ne correspondent pas.',
    'profile.validationError': 'Erreur de validation',
    'profile.passwordUpdated': 'Mot de passe changé avec succès.',
    'profile.saveFailed': 'Erreur lors de la mise à jour du mot de passe.',
    'profile.saveInProgress': 'Enregistrement...',

    'equipment.title': "Détails de l'équipement",
    'equipment.subtitle': 'Informations complètes et réservation en temps réel.',
    'equipment.notFoundTitle': 'Objet introuvable',
    'equipment.notFoundBody': "Cet équipement n'existe pas.",
    'equipment.back': 'Retour',
    'equipment.noDistance': 'Distance non disponible',
    'equipment.noBuilding': 'Bâtiment non défini',
    'equipment.noFloor': 'Étage non défini',
    'equipment.noRoom': 'Salle non définie',
    'equipment.noFeatures': 'Aucune fonctionnalité renseignée.',
    'equipment.noDescription': 'Aucune description disponible pour cet objet.',
    'equipment.reservation': 'Réservation',
    'equipment.reserve': 'Réserver',
    'equipment.complete': 'Terminer la réservation',
    'equipment.cancel': 'Annuler la réservation',
    'equipment.unavailable': 'Indisponible (Panne)',
    'equipment.processing': 'Traitement...',
    'equipment.queue': 'Personnes en attente',
    'equipment.waiting': "Vous êtes dans la file d'attente.",
    'equipment.active': 'Votre réservation est active.',
    'equipment.reservationHandled': 'Réservation traitée.',
    'equipment.cancelledSuccess': 'Réservation annulée avec succès.',
    'equipment.completedSuccess': 'Réservation terminée.',
    'equipment.reserveError': 'Erreur lors de la réservation.',
    'equipment.cancelError': "Erreur lors de l'annulation.",
    'equipment.completeError': 'Erreur lors de la finalisation.',
    'equipment.completeMissing': 'Impossible de terminer: réservation introuvable.',

    'auth.login': 'Connexion',
    'auth.signup': 'Inscription',
    'auth.email': 'Email',
    'auth.password': 'Mot de passe',
    'auth.signIn': 'Se connecter',
    'auth.createAccount': 'Créer un compte',
    'auth.alreadyAccount': 'Déjà un compte ? Se connecter',
    'auth.noAccount': 'Créer un compte',
    'auth.loginError': 'Email ou mot de passe incorrect.',
    'auth.signupError': "Erreur lors de l'inscription.",
    'auth.signupSuccess': 'Compte créé ! Connectez-vous.',
    'auth.lastName': 'Nom',
    'auth.firstName': 'Prénom',
    'auth.createMyAccount': 'Créer mon compte',

    'admin.title': 'Administration',
    'admin.subtitle': 'Gestion des incidents et alertes signalées.',
    'admin.alerts': 'Alertes',
    'admin.users': 'Utilisateurs',
    'admin.noAlerts': 'Aucune alerte.',
    'admin.resolve': 'Résoudre',
    'admin.resolveConfirm': 'Résoudre ?',
    'admin.forbidden': 'Accès interdit.',
    'admin.error': 'Erreur.',

    'inventory.title': "Gestion de l'inventaire",
    'inventory.subtitle': 'Ajoutez, modifiez ou supprimez des équipements.',
    'inventory.addEquipment': 'Ajouter un équipement',
    'inventory.type': 'Type',
    'inventory.nameModel': 'Nom / Modèle',
    'inventory.location': 'Emplacement',
    'inventory.status': 'Statut',
    'inventory.actions': 'Actions',
    'inventory.loading': 'Chargement...',
    'inventory.mac': 'MAC',
    'inventory.room': 'Salle',
    'inventory.newEquipment': 'Nouvel équipement',
    'inventory.brand': 'Marque',
    'inventory.model': 'Modèle',
    'inventory.roomLocation': 'Emplacement (Salle)',
    'inventory.chooseRoom': '-- Choisir une salle --',
    'inventory.noRooms': 'Aucune salle trouvée dans la base',
    'inventory.macAddress': 'Adresse MAC',
    'inventory.exampleCanon': 'Ex: Canon',
    'inventory.examplePixma': 'Ex: Pixma 300',
    'inventory.itemAdded': 'Équipement ajouté avec succès !',
    'inventory.addError': 'Erreur ajout',
    'inventory.deleteConfirm': 'Supprimer définitivement ?',
    'inventory.deleteError': 'Erreur suppression',
  },
  en: {
    'nav.home': 'Home',
    'nav.map': 'Map',
    'nav.categories': 'Categories',
    'nav.history': 'History',
    'nav.profile': 'Profile',
    'nav.admin': 'Admin',
    'nav.search': 'Search',
    'nav.notifications': 'Notifications',
    'nav.markAllRead': 'Mark all',
    'nav.loading': 'Loading...',
    'nav.noNotifications': 'No notifications.',
    'nav.myProfile': 'My Profile',
    'nav.logout': 'Logout',
    'nav.modeLight': 'Light mode',
    'nav.modeDark': 'Dark mode',
    'nav.switchToLight': 'Switch to light mode',
    'nav.switchToDark': 'Switch to dark mode',

    'common.loading': 'Loading...',
    'common.notFound': 'Not found',
    'common.search': 'Search',
    'common.filter': 'Filter',
    'common.advancedFilters': 'Advanced filters',
    'common.apply': 'Apply',
    'common.reset': 'Reset',
    'common.cancel': 'Cancel',
    'common.save': 'Save',
    'common.previous': 'Previous',
    'common.next': 'Next',
    'common.page': 'Page',
    'common.all': 'All',
    'common.allF': 'All',
    'common.status': 'Status',
    'common.type': 'Type',
    'common.brand': 'Brand',
    'common.floor': 'Floor',
    'common.room': 'Room',
    'common.distance': 'Distance',
    'common.description': 'Description',
    'common.features': 'Features',
    'common.actions': 'Actions',
    'common.target': 'Target',
    'common.language': 'Language',
    'common.chooseLanguage': 'Choose language',

    'home.heroTitle': 'What are you looking for in the building?',
    'home.heroSub': 'Search for equipment, check availability, and quickly open its details.',
    'home.searchPlaceholder': 'Ex: Printer, 4K Projector, Scanner...',
    'home.quickAccess': 'Quick access',
    'home.seeAll': 'See all',
    'home.noCategories': 'No category available.',
    'home.distanceSort': 'Sort by distance (near → far)',
    'home.footerProject': 'SMARTFIND — Final year project',

    'search.placeholder': 'Search (ex: Scanner, Printer...)',
    'search.fonction': 'Feature',
    'search.floorLabel': 'Floor',
    'search.roomLabel': 'Room',
    'search.distanceSort': 'Sort by distance (near → far)',
    'search.distanceMax': 'Max distance (optional)',
    'search.distanceExample': 'ex: 30',
    'search.searching': 'Searching...',
    'search.results': 'results',
    'search.distanceFromUser': 'from your location',
    'search.viewDetails': 'View details',
    'search.unknownRoom': 'Unknown room',
    'search.floorPrefix': 'Floor',
    'search.unknownDistance': 'Unknown distance',

    'categories.title': 'Equipment catalog',
    'categories.subtitle': 'Access inventory by category.',
    'categories.noData': 'No category available.',
    'categories.devices': 'devices',

    'history.title': 'Activity log',
    'history.subtitle': 'Track actions and search history.',
    'history.recentActions': 'Recent actions',
    'history.searchHistory': 'Search history',
    'history.noRecentActions': 'No recent actions.',
    'history.noSearchHistory': 'No saved searches.',
    'history.equipmentReservation': 'Equipment reservation',
    'history.unknownDate': 'Unknown date',

    'profile.userNotFound': 'User not found.',
    'profile.preferences': 'Preferences',
    'profile.changePassword': 'Change password',
    'profile.currentPassword': 'Current password',
    'profile.newPassword': 'New password',
    'profile.confirmPassword': 'Confirm new password',
    'profile.fillAllFields': 'Please fill all fields.',
    'profile.passwordMin': 'New password must be at least 6 characters.',
    'profile.passwordMismatch': 'Passwords do not match.',
    'profile.validationError': 'Validation error',
    'profile.passwordUpdated': 'Password changed successfully.',
    'profile.saveFailed': 'Error while updating password.',
    'profile.saveInProgress': 'Saving...',

    'equipment.title': 'Equipment details',
    'equipment.subtitle': 'Full information and real-time reservation.',
    'equipment.notFoundTitle': 'Object not found',
    'equipment.notFoundBody': 'This equipment does not exist.',
    'equipment.back': 'Back',
    'equipment.noDistance': 'Distance not available',
    'equipment.noBuilding': 'Building not specified',
    'equipment.noFloor': 'Floor not specified',
    'equipment.noRoom': 'Room not specified',
    'equipment.noFeatures': 'No features specified.',
    'equipment.noDescription': 'No description available for this object.',
    'equipment.reservation': 'Reservation',
    'equipment.reserve': 'Reserve',
    'equipment.complete': 'Complete reservation',
    'equipment.cancel': 'Cancel reservation',
    'equipment.unavailable': 'Unavailable (Out of order)',
    'equipment.processing': 'Processing...',
    'equipment.queue': 'People waiting',
    'equipment.waiting': 'You are in the waiting queue.',
    'equipment.active': 'Your reservation is active.',
    'equipment.reservationHandled': 'Reservation processed.',
    'equipment.cancelledSuccess': 'Reservation cancelled successfully.',
    'equipment.completedSuccess': 'Reservation completed.',
    'equipment.reserveError': 'Reservation failed.',
    'equipment.cancelError': 'Cancellation failed.',
    'equipment.completeError': 'Completion failed.',
    'equipment.completeMissing': 'Cannot complete: reservation not found.',

    'auth.login': 'Sign in',
    'auth.signup': 'Sign up',
    'auth.email': 'Email',
    'auth.password': 'Password',
    'auth.signIn': 'Sign in',
    'auth.createAccount': 'Create an account',
    'auth.alreadyAccount': 'Already have an account? Sign in',
    'auth.noAccount': 'Create an account',
    'auth.loginError': 'Incorrect email or password.',
    'auth.signupError': 'Sign-up failed.',
    'auth.signupSuccess': 'Account created! Please sign in.',
    'auth.lastName': 'Last name',
    'auth.firstName': 'First name',
    'auth.createMyAccount': 'Create account',

    'admin.title': 'Administration',
    'admin.subtitle': 'Manage reported incidents and alerts.',
    'admin.alerts': 'Alerts',
    'admin.users': 'Users',
    'admin.noAlerts': 'No alerts.',
    'admin.resolve': 'Resolve',
    'admin.resolveConfirm': 'Resolve?',
    'admin.forbidden': 'Access denied.',
    'admin.error': 'Error.',

    'inventory.title': 'Inventory management',
    'inventory.subtitle': 'Add, edit, or delete equipment.',
    'inventory.addEquipment': 'Add equipment',
    'inventory.type': 'Type',
    'inventory.nameModel': 'Name / Model',
    'inventory.location': 'Location',
    'inventory.status': 'Status',
    'inventory.actions': 'Actions',
    'inventory.loading': 'Loading...',
    'inventory.mac': 'MAC',
    'inventory.room': 'Room',
    'inventory.newEquipment': 'New equipment',
    'inventory.brand': 'Brand',
    'inventory.model': 'Model',
    'inventory.roomLocation': 'Location (Room)',
    'inventory.chooseRoom': '-- Select a room --',
    'inventory.noRooms': 'No rooms found in database',
    'inventory.macAddress': 'MAC address',
    'inventory.exampleCanon': 'Ex: Canon',
    'inventory.examplePixma': 'Ex: Pixma 300',
    'inventory.itemAdded': 'Equipment added successfully!',
    'inventory.addError': 'Add error',
    'inventory.deleteConfirm': 'Delete permanently?',
    'inventory.deleteError': 'Delete error',
  },
  es: {
    'nav.home': 'Inicio',
    'nav.map': 'Mapa',
    'nav.categories': 'Categorias',
    'nav.history': 'Historial',
    'nav.profile': 'Perfil',
    'nav.admin': 'Admin',
    'nav.search': 'Buscar',
    'nav.notifications': 'Notificaciones',
    'nav.markAllRead': 'Marcar todo',
    'nav.loading': 'Cargando...',
    'nav.noNotifications': 'Sin notificaciones.',
    'nav.myProfile': 'Mi perfil',
    'nav.logout': 'Cerrar sesión',
    'nav.modeLight': 'Modo claro',
    'nav.modeDark': 'Modo oscuro',
    'nav.switchToLight': 'Cambiar a modo claro',
    'nav.switchToDark': 'Cambiar a modo oscuro',

    'common.loading': 'Cargando...',
    'common.notFound': 'No encontrado',
    'common.search': 'Buscar',
    'common.filter': 'Filtro',
    'common.advancedFilters': 'Filtros avanzados',
    'common.apply': 'Aplicar',
    'common.reset': 'Restablecer',
    'common.cancel': 'Cancelar',
    'common.save': 'Guardar',
    'common.previous': 'Anterior',
    'common.next': 'Siguiente',
    'common.page': 'Página',
    'common.all': 'Todos',
    'common.allF': 'Todas',
    'common.status': 'Estado',
    'common.type': 'Tipo',
    'common.brand': 'Marca',
    'common.floor': 'Piso',
    'common.room': 'Sala',
    'common.distance': 'Distancia',
    'common.description': 'Descripción',
    'common.features': 'Funciones',
    'common.actions': 'Acciones',
    'common.target': 'Objetivo',
    'common.language': 'Idioma',
    'common.chooseLanguage': 'Elegir idioma',

    'home.heroTitle': '¿Qué buscas en el edificio?',
    'home.heroSub': 'Busca un equipo, verifica su disponibilidad y abre rápidamente su ficha.',
    'home.searchPlaceholder': 'Ej: Impresora, Proyector 4K, Escáner...',
    'home.quickAccess': 'Acceso rápido',
    'home.seeAll': 'Ver todo',
    'home.noCategories': 'No hay categorías disponibles.',
    'home.distanceSort': 'Ordenar por distancia (cerca → lejos)',
    'home.footerProject': 'SMARTFIND — Proyecto fin de grado',

    'search.placeholder': 'Buscar (ej: Escáner, Impresora...)',
    'search.fonction': 'Función',
    'search.floorLabel': 'Piso',
    'search.roomLabel': 'Sala',
    'search.distanceSort': 'Ordenar por distancia (cerca → lejos)',
    'search.distanceMax': 'Distancia máxima (opcional)',
    'search.distanceExample': 'ej: 30',
    'search.searching': 'Buscando...',
    'search.results': 'resultados',
    'search.distanceFromUser': 'de tu ubicación',
    'search.viewDetails': 'Ver detalles',
    'search.unknownRoom': 'Sala desconocida',
    'search.floorPrefix': 'Piso',
    'search.unknownDistance': 'Distancia desconocida',

    'categories.title': 'Catálogo de equipos',
    'categories.subtitle': 'Accede al inventario por categoría.',
    'categories.noData': 'No hay categorías disponibles.',
    'categories.devices': 'equipos',

    'history.title': 'Registro de actividad',
    'history.subtitle': 'Seguimiento de acciones e historial de búsqueda.',
    'history.recentActions': 'Acciones recientes',
    'history.searchHistory': 'Historial de búsqueda',
    'history.noRecentActions': 'Sin acciones recientes.',
    'history.noSearchHistory': 'Sin búsquedas guardadas.',
    'history.equipmentReservation': 'Reserva de equipo',
    'history.unknownDate': 'Fecha desconocida',

    'profile.userNotFound': 'Usuario no encontrado.',
    'profile.preferences': 'Preferencias',
    'profile.changePassword': 'Cambiar contraseña',
    'profile.currentPassword': 'Contraseña actual',
    'profile.newPassword': 'Nueva contraseña',
    'profile.confirmPassword': 'Confirmar nueva contraseña',
    'profile.fillAllFields': 'Complete todos los campos.',
    'profile.passwordMin': 'La nueva contraseña debe tener al menos 6 caracteres.',
    'profile.passwordMismatch': 'Las contraseñas no coinciden.',
    'profile.validationError': 'Error de validación',
    'profile.passwordUpdated': 'Contraseña actualizada correctamente.',
    'profile.saveFailed': 'Error al actualizar la contraseña.',
    'profile.saveInProgress': 'Guardando...',

    'equipment.title': 'Detalles del equipo',
    'equipment.subtitle': 'Información completa y reserva en tiempo real.',
    'equipment.notFoundTitle': 'Objeto no encontrado',
    'equipment.notFoundBody': 'Este equipo no existe.',
    'equipment.back': 'Volver',
    'equipment.noDistance': 'Distancia no disponible',
    'equipment.noBuilding': 'Edificio no definido',
    'equipment.noFloor': 'Piso no definido',
    'equipment.noRoom': 'Sala no definida',
    'equipment.noFeatures': 'No hay funcionalidades.',
    'equipment.noDescription': 'No hay descripción para este objeto.',
    'equipment.reservation': 'Reserva',
    'equipment.reserve': 'Reservar',
    'equipment.complete': 'Finalizar reserva',
    'equipment.cancel': 'Cancelar reserva',
    'equipment.unavailable': 'No disponible (Avería)',
    'equipment.processing': 'Procesando...',
    'equipment.queue': 'Personas en espera',
    'equipment.waiting': 'Estás en la cola de espera.',
    'equipment.active': 'Tu reserva está activa.',
    'equipment.reservationHandled': 'Reserva procesada.',
    'equipment.cancelledSuccess': 'Reserva cancelada correctamente.',
    'equipment.completedSuccess': 'Reserva finalizada.',
    'equipment.reserveError': 'Error al reservar.',
    'equipment.cancelError': 'Error al cancelar.',
    'equipment.completeError': 'Error al finalizar.',
    'equipment.completeMissing': 'No se puede finalizar: reserva no encontrada.',

    'auth.login': 'Iniciar sesión',
    'auth.signup': 'Registro',
    'auth.email': 'Correo',
    'auth.password': 'Contraseña',
    'auth.signIn': 'Entrar',
    'auth.createAccount': 'Crear cuenta',
    'auth.alreadyAccount': '¿Ya tienes cuenta? Entrar',
    'auth.noAccount': 'Crear cuenta',
    'auth.loginError': 'Correo o contraseña incorrectos.',
    'auth.signupError': 'Error en el registro.',
    'auth.signupSuccess': '¡Cuenta creada! Inicia sesión.',
    'auth.lastName': 'Apellido',
    'auth.firstName': 'Nombre',
    'auth.createMyAccount': 'Crear mi cuenta',

    'admin.title': 'Administración',
    'admin.subtitle': 'Gestión de incidencias y alertas reportadas.',
    'admin.alerts': 'Alertas',
    'admin.users': 'Usuarios',
    'admin.noAlerts': 'Sin alertas.',
    'admin.resolve': 'Resolver',
    'admin.resolveConfirm': '¿Resolver?',
    'admin.forbidden': 'Acceso denegado.',
    'admin.error': 'Error.',

    'inventory.title': 'Gestión de inventario',
    'inventory.subtitle': 'Añade, edita o elimina equipos.',
    'inventory.addEquipment': 'Añadir equipo',
    'inventory.type': 'Tipo',
    'inventory.nameModel': 'Nombre / Modelo',
    'inventory.location': 'Ubicación',
    'inventory.status': 'Estado',
    'inventory.actions': 'Acciones',
    'inventory.loading': 'Cargando...',
    'inventory.mac': 'MAC',
    'inventory.room': 'Sala',
    'inventory.newEquipment': 'Nuevo equipo',
    'inventory.brand': 'Marca',
    'inventory.model': 'Modelo',
    'inventory.roomLocation': 'Ubicación (Sala)',
    'inventory.chooseRoom': '-- Elegir sala --',
    'inventory.noRooms': 'No se encontraron salas en la base',
    'inventory.macAddress': 'Dirección MAC',
    'inventory.exampleCanon': 'Ej: Canon',
    'inventory.examplePixma': 'Ej: Pixma 300',
    'inventory.itemAdded': '¡Equipo añadido con éxito!',
    'inventory.addError': 'Error al añadir',
    'inventory.deleteConfirm': '¿Eliminar definitivamente?',
    'inventory.deleteError': 'Error al eliminar',
  },
  ar: {
    'nav.home': 'الرئيسية',
    'nav.map': 'الخريطة',
    'nav.categories': 'الفئات',
    'nav.history': 'السجل',
    'nav.profile': 'الملف الشخصي',
    'nav.admin': 'الإدارة',
    'nav.search': 'بحث',
    'nav.notifications': 'الإشعارات',
    'nav.markAllRead': 'قراءة الكل',
    'nav.loading': 'جار التحميل...',
    'nav.noNotifications': 'لا توجد إشعارات.',
    'nav.myProfile': 'ملفي',
    'nav.logout': 'تسجيل الخروج',
    'nav.modeLight': 'الوضع الفاتح',
    'nav.modeDark': 'الوضع الداكن',
    'nav.switchToLight': 'التحويل إلى الوضع الفاتح',
    'nav.switchToDark': 'التحويل إلى الوضع الداكن',

    'common.loading': 'جار التحميل...',
    'common.notFound': 'غير موجود',
    'common.search': 'بحث',
    'common.filter': 'فلتر',
    'common.advancedFilters': 'فلاتر متقدمة',
    'common.apply': 'تطبيق',
    'common.reset': 'إعادة ضبط',
    'common.cancel': 'إلغاء',
    'common.save': 'حفظ',
    'common.previous': 'السابق',
    'common.next': 'التالي',
    'common.page': 'صفحة',
    'common.all': 'الكل',
    'common.allF': 'الكل',
    'common.status': 'الحالة',
    'common.type': 'النوع',
    'common.brand': 'العلامة',
    'common.floor': 'الطابق',
    'common.room': 'القاعة',
    'common.distance': 'المسافة',
    'common.description': 'الوصف',
    'common.features': 'الخصائص',
    'common.actions': 'الإجراءات',
    'common.target': 'الهدف',
    'common.language': 'اللغة',
    'common.chooseLanguage': 'اختر اللغة',

    'home.heroTitle': 'ماذا تبحث داخل المبنى؟',
    'home.heroSub': 'ابحث عن جهاز، تحقق من توفره، وافتح التفاصيل بسرعة.',
    'home.searchPlaceholder': 'مثال: طابعة، عارض 4K، ماسح...',
    'home.quickAccess': 'وصول سريع',
    'home.seeAll': 'عرض الكل',
    'home.noCategories': 'لا توجد فئات متاحة.',
    'home.distanceSort': 'ترتيب حسب المسافة (قريب ← بعيد)',
    'home.footerProject': 'SMARTFIND — مشروع نهاية الدراسة',

    'search.placeholder': 'ابحث (مثال: ماسح، طابعة...)',
    'search.fonction': 'الوظيفة',
    'search.floorLabel': 'الطابق',
    'search.roomLabel': 'القاعة',
    'search.distanceSort': 'ترتيب حسب المسافة (قريب ← بعيد)',
    'search.distanceMax': 'أقصى مسافة (اختياري)',
    'search.distanceExample': 'مثال: 30',
    'search.searching': 'جاري البحث...',
    'search.results': 'نتائج',
    'search.distanceFromUser': 'من موقعك',
    'search.viewDetails': 'عرض التفاصيل',
    'search.unknownRoom': 'قاعة غير معروفة',
    'search.floorPrefix': 'الطابق',
    'search.unknownDistance': 'مسافة غير معروفة',

    'categories.title': 'كتالوج التجهيزات',
    'categories.subtitle': 'الوصول إلى الجرد حسب الفئة.',
    'categories.noData': 'لا توجد فئات متاحة.',
    'categories.devices': 'أجهزة',

    'history.title': 'سجل الأنشطة',
    'history.subtitle': 'متابعة الإجراءات وسجل البحث.',
    'history.recentActions': 'الإجراءات الأخيرة',
    'history.searchHistory': 'سجل البحث',
    'history.noRecentActions': 'لا توجد إجراءات حديثة.',
    'history.noSearchHistory': 'لا يوجد سجل بحث.',
    'history.equipmentReservation': 'حجز جهاز',
    'history.unknownDate': 'تاريخ غير معروف',

    'profile.userNotFound': 'المستخدم غير موجود.',
    'profile.preferences': 'التفضيلات',
    'profile.changePassword': 'تغيير كلمة المرور',
    'profile.currentPassword': 'كلمة المرور الحالية',
    'profile.newPassword': 'كلمة المرور الجديدة',
    'profile.confirmPassword': 'تأكيد كلمة المرور الجديدة',
    'profile.fillAllFields': 'يرجى ملء كل الحقول.',
    'profile.passwordMin': 'كلمة المرور الجديدة يجب أن تكون 6 أحرف على الأقل.',
    'profile.passwordMismatch': 'كلمتا المرور غير متطابقتين.',
    'profile.validationError': 'خطأ في التحقق من البيانات',
    'profile.passwordUpdated': 'تم تغيير كلمة المرور بنجاح.',
    'profile.saveFailed': 'خطأ أثناء تحديث كلمة المرور.',
    'profile.saveInProgress': 'جاري الحفظ...',

    'equipment.title': 'تفاصيل الجهاز',
    'equipment.subtitle': 'معلومات كاملة وحجز في الوقت الحقيقي.',
    'equipment.notFoundTitle': 'العنصر غير موجود',
    'equipment.notFoundBody': 'هذا الجهاز غير موجود.',
    'equipment.back': 'رجوع',
    'equipment.noDistance': 'المسافة غير متوفرة',
    'equipment.noBuilding': 'مبنى غير محدد',
    'equipment.noFloor': 'طابق غير محدد',
    'equipment.noRoom': 'قاعة غير محددة',
    'equipment.noFeatures': 'لا توجد خصائص.',
    'equipment.noDescription': 'لا يوجد وصف لهذا العنصر.',
    'equipment.reservation': 'الحجز',
    'equipment.reserve': 'احجز',
    'equipment.complete': 'إنهاء الحجز',
    'equipment.cancel': 'إلغاء الحجز',
    'equipment.unavailable': 'غير متاح (عطل)',
    'equipment.processing': 'جاري المعالجة...',
    'equipment.queue': 'الأشخاص في الانتظار',
    'equipment.waiting': 'أنت في قائمة الانتظار.',
    'equipment.active': 'حجزك نشط الآن.',
    'equipment.reservationHandled': 'تمت معالجة الحجز.',
    'equipment.cancelledSuccess': 'تم إلغاء الحجز بنجاح.',
    'equipment.completedSuccess': 'تم إنهاء الحجز.',
    'equipment.reserveError': 'حدث خطأ أثناء الحجز.',
    'equipment.cancelError': 'حدث خطأ أثناء الإلغاء.',
    'equipment.completeError': 'حدث خطأ أثناء الإنهاء.',
    'equipment.completeMissing': 'تعذر الإنهاء: الحجز غير موجود.',

    'auth.login': 'تسجيل الدخول',
    'auth.signup': 'إنشاء حساب',
    'auth.email': 'البريد الإلكتروني',
    'auth.password': 'كلمة المرور',
    'auth.signIn': 'دخول',
    'auth.createAccount': 'إنشاء حساب',
    'auth.alreadyAccount': 'لديك حساب؟ سجل الدخول',
    'auth.noAccount': 'إنشاء حساب',
    'auth.loginError': 'البريد الإلكتروني أو كلمة المرور غير صحيحة.',
    'auth.signupError': 'حدث خطأ أثناء التسجيل.',
    'auth.signupSuccess': 'تم إنشاء الحساب! سجل الدخول.',
    'auth.lastName': 'الاسم العائلي',
    'auth.firstName': 'الاسم الشخصي',
    'auth.createMyAccount': 'إنشاء حسابي',

    'admin.title': 'الإدارة',
    'admin.subtitle': 'إدارة الحوادث والتنبيهات المبلغ عنها.',
    'admin.alerts': 'تنبيهات',
    'admin.users': 'مستخدمون',
    'admin.noAlerts': 'لا توجد تنبيهات.',
    'admin.resolve': 'حل',
    'admin.resolveConfirm': 'تأكيد الحل؟',
    'admin.forbidden': 'الوصول مرفوض.',
    'admin.error': 'خطأ.',

    'inventory.title': 'إدارة الجرد',
    'inventory.subtitle': 'إضافة أو تعديل أو حذف التجهيزات.',
    'inventory.addEquipment': 'إضافة جهاز',
    'inventory.type': 'النوع',
    'inventory.nameModel': 'الاسم / الموديل',
    'inventory.location': 'المكان',
    'inventory.status': 'الحالة',
    'inventory.actions': 'الإجراءات',
    'inventory.loading': 'جار التحميل...',
    'inventory.mac': 'MAC',
    'inventory.room': 'القاعة',
    'inventory.newEquipment': 'جهاز جديد',
    'inventory.brand': 'العلامة',
    'inventory.model': 'الموديل',
    'inventory.roomLocation': 'المكان (القاعة)',
    'inventory.chooseRoom': '-- اختر القاعة --',
    'inventory.noRooms': 'لا توجد قاعات في قاعدة البيانات',
    'inventory.macAddress': 'عنوان MAC',
    'inventory.exampleCanon': 'مثال: Canon',
    'inventory.examplePixma': 'مثال: Pixma 300',
    'inventory.itemAdded': 'تمت إضافة الجهاز بنجاح!',
    'inventory.addError': 'خطأ إضافة',
    'inventory.deleteConfirm': 'حذف نهائي؟',
    'inventory.deleteError': 'خطأ حذف',
  },
};

const DATA_TRANSLATIONS = {
  status: {
    disponible: { fr: 'Disponible', en: 'Available', es: 'Disponible', ar: 'متاح' },
    available: { fr: 'Disponible', en: 'Available', es: 'Disponible', ar: 'متاح' },
    occupe: { fr: 'Occupé', en: 'Occupied', es: 'Ocupado', ar: 'مشغول' },
    occupé: { fr: 'Occupé', en: 'Occupied', es: 'Ocupado', ar: 'مشغول' },
    occupied: { fr: 'Occupé', en: 'Occupied', es: 'Ocupado', ar: 'مشغول' },
    panne: { fr: 'Panne', en: 'Out of order', es: 'Avería', ar: 'عطل' },
    'out of order': { fr: 'Panne', en: 'Out of order', es: 'Avería', ar: 'عطل' },
  },
  role: {
    utilisateur: { fr: 'Utilisateur', en: 'User', es: 'Usuario', ar: 'مستخدم' },
    user: { fr: 'Utilisateur', en: 'User', es: 'Usuario', ar: 'مستخدم' },
    admin: { fr: 'Administrateur', en: 'Administrator', es: 'Administrador', ar: 'مدير' },
    administrateur: { fr: 'Administrateur', en: 'Administrator', es: 'Administrador', ar: 'مدير' },
    administrator: { fr: 'Administrateur', en: 'Administrator', es: 'Administrador', ar: 'مدير' },
  },
  reservationStatus: {
    active: { fr: 'En cours', en: 'Active', es: 'Activa', ar: 'نشط' },
    waiting: { fr: 'En attente', en: 'Waiting', es: 'En espera', ar: 'في الانتظار' },
    cancelled: { fr: 'Annulée', en: 'Cancelled', es: 'Cancelada', ar: 'ملغاة' },
    canceled: { fr: 'Annulée', en: 'Cancelled', es: 'Cancelada', ar: 'ملغاة' },
    done: { fr: 'Terminée', en: 'Done', es: 'Terminada', ar: 'منتهية' },
    completed: { fr: 'Terminée', en: 'Done', es: 'Terminada', ar: 'منتهية' },
    termine: { fr: 'Terminée', en: 'Done', es: 'Terminada', ar: 'منتهية' },
    terminé: { fr: 'Terminée', en: 'Done', es: 'Terminada', ar: 'منتهية' },
  },
  type: {
    imprimante: { fr: 'Imprimante', en: 'Printer', es: 'Impresora', ar: 'طابعة' },
    projecteur: { fr: 'Projecteur', en: 'Projector', es: 'Proyector', ar: 'عارض' },
    scanner: { fr: 'Scanner', en: 'Scanner', es: 'Escáner', ar: 'ماسح' },
    écran: { fr: 'Écran', en: 'Screen', es: 'Pantalla', ar: 'شاشة' },
    ecran: { fr: 'Écran', en: 'Screen', es: 'Pantalla', ar: 'شاشة' },
    réseau: { fr: 'Réseau', en: 'Network', es: 'Red', ar: 'شبكة' },
    reseau: { fr: 'Réseau', en: 'Network', es: 'Red', ar: 'شبكة' },
    'contrôle accès': { fr: "Contrôle d'accès", en: 'Access control', es: 'Control de acceso', ar: 'التحكم في الولوج' },
    'contrôle d’accès': { fr: "Contrôle d'accès", en: 'Access control', es: 'Control de acceso', ar: 'التحكم في الولوج' },
    'controle acces': { fr: "Contrôle d'accès", en: 'Access control', es: 'Control de acceso', ar: 'التحكم في الولوج' },
    'controle d’acces': { fr: "Contrôle d'accès", en: 'Access control', es: 'Control de acceso', ar: 'التحكم في الولوج' },
    pc: { fr: 'PC', en: 'PC', es: 'PC', ar: 'حاسوب' },
  },
};

const normalize = (value) =>
  String(value || '')
    .toLowerCase()
    .normalize('NFD')
    .replace(/[\u0300-\u036f]/g, '')
    .trim();

const I18nContext = createContext(null);

export const I18nProvider = ({ children }) => {
  const [language, setLanguage] = useState(() => {
    const saved = localStorage.getItem('app_language');
    return ['fr', 'en', 'es', 'ar'].includes(saved) ? saved : 'fr';
  });

  useEffect(() => {
    localStorage.setItem('app_language', language);
    document.documentElement.setAttribute('lang', language);
    document.documentElement.setAttribute('dir', language === 'ar' ? 'rtl' : 'ltr');
  }, [language]);

  const value = useMemo(() => {
    const t = (key) => {
      const langDict = TRANSLATIONS[language] || TRANSLATIONS.fr;
      return langDict[key] || TRANSLATIONS.fr[key] || key;
    };

    const translateData = (kind, raw) => {
      if (raw === null || raw === undefined) return '';
      const normalized = normalize(raw);
      const map = DATA_TRANSLATIONS[kind];
      if (!map) return String(raw);
      const entry = map[normalized];
      if (!entry) return String(raw);
      return entry[language] || entry.fr || String(raw);
    };

    const locale = language === 'ar' ? 'ar' : language === 'es' ? 'es-ES' : language === 'en' ? 'en-US' : 'fr-FR';

    return {
      language,
      setLanguage,
      languageOptions: LANGUAGE_OPTIONS,
      isRTL: language === 'ar',
      t,
      translateData,
      locale,
    };
  }, [language]);

  return <I18nContext.Provider value={value}>{children}</I18nContext.Provider>;
};

export const useI18n = () => {
  const ctx = useContext(I18nContext);
  if (!ctx) {
    throw new Error('useI18n must be used inside I18nProvider');
  }
  return ctx;
};
